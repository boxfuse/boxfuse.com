---
layout: docs
menu: nodejs
subtitle: 'Node.js'
---
<div id="war">
    <p><img src="/assets/img/nodejs.png"></p>

    <p>Boxfuse supports apps written in JavaScript or any other language and packaged as an <strong>.tgz file</strong> running on <strong>Node.js 5.7 or newer</strong>.</p>

    <h2>Packaging</h2>

    <p>Applications should be packaged using with all dependencies marked as <code>bundledDependencies</code>.
        The easiest way to achieve this is to use <strong><a href="https://github.com/majgis/npm-bundle">npm-bundle</a></strong>.</p>

    <p>Start by installing <strong>npm-bundle</strong>:</p>

    <pre class="console"><span>&gt;</span> npm install -g npm-bundle</pre>

    <p>Make sure you shrinkwrap your project (this will create a <code>npm-shrinkwrap.json</code> file):</p>

    <pre class="console"><span>&gt;</span> npm shrinkwrap</pre>

    <p>Then simply create the <code>tgz</code> in the directory containing your <code>package.json</code>:</p>

    <pre class="console"><span>&gt;</span> npm-bundle</pre>

    <p>And finally fuse and run the Boxfuse image from that same directory:</p>

    <pre class="console"><span>&gt;</span> boxfuse run</pre>

    <h2>Node.js version</h2>

    <p>By default Boxfuse uses the <strong>latest Node.js version</strong> (Current branch). If you want to switch to an
        LTS release or simply an older version, you can do so using the <code><nobr>-components.nodejs</nobr></code> configuration setting:</p>

    <pre class="console"><span>&gt;</span> boxfuse run my-app-1.0.tgz <strong>-components.nodejs=</strong>5.9.1</pre>

    <p>To find out which Node.js versions are available from the Boxfuse Inventory you can simply issue:</p>

    <pre class="console"><span>&gt;</span> boxfuse inventory nodejs</pre>

    <h2>Ports</h2>

    <p>By Boxfuse configures your application <code>http</code> port as well as the <code>PORT</code> environment variable to <code>80</code>.
        If your application has been generated by express it should pick this up automatically. Otherwise you need to adjust
        either your application or the Boxfuse ports configuration to match.</p>

    <h2 id="databases">Databases</h2>

    <p>When using the <a href="/docs/databases">Boxfuse database auto-provisioning support</a>, Boxfuse automatically
        exposes your database's host, port, name, user and password for the current environment as environment variables.</p>

    <p>If your app includes the <strong><a href="https://github.com/brianc/node-postgres">pg</a></strong> or <strong><a href="https://github.com/felixge/node-mysql">mysql</a></strong> npm module, Boxfuse will automatically provision the necessary PostgreSQL or MySQL database
        in each environment.</p>

    <p>To disable database auto-provisioning set <code>dbtype</code> to <code>none</code> when <a href="/docs/commandline/create#dbtype">creating your app</a>.</p>

    <h3>MySQL</h3>

    <p>To connect to your MySQL database you can use the following code:</p>

    <pre class="prettyprint">var mysql = require('mysql');
var connection = mysql.createConnection({
  host     : process.env.BOXFUSE_DATABASE_HOST,
  port     : process.env.BOXFUSE_DATABASE_PORT,
  user     : process.env.BOXFUSE_DATABASE_USER,
  password : process.env.BOXFUSE_DATABASE_PASSWORD,
  database : process.env.BOXFUSE_DATABASE_NAME,
  ssl      : process.env.BOXFUSE_DATABASE_CA_CERT,
  charset  : 'utf8mb4_unicode_ci',
  timezone : 'utc'
});
// Execute query</pre>

    <p>This also automatically ensures that all connections to RDS MySQL use TLS (SSL).</p>

    <h3>PostgreSQL</h3>

    <p>To connect to your PostgreSQL database you can use the following code:</p>

    <pre class="prettyprint">var pg = require('pg');
var fs = require('fs');

var connectionInfo = {
  host     : process.env.BOXFUSE_DATABASE_HOST,
  port     : process.env.BOXFUSE_DATABASE_PORT,
  user     : process.env.BOXFUSE_DATABASE_USER,
  password : process.env.BOXFUSE_DATABASE_PASSWORD,
  database : process.env.BOXFUSE_DATABASE_NAME
}
if (process.env.BOXFUSE_DATABASE_CA_CERT) {
  connectionInfo.ssl = {
    ca: [fs.readFileSync(process.env.BOXFUSE_DATABASE_CA_CERT, 'utf8')]
  };
}

var client = new pg.Client(connectionInfo);
client.connect(function(err) {
  // Execute query
});</pre>

    <p>This also automatically ensures that all connections to RDS PostgreSQL use TLS (SSL).</p>

    <h2>Temporary Files</h2>

    <p>Boxfuse configures the JVM to use <code>/tmp</code> as the directory to store temporary files and provisions <strong>1 GB of space by default</strong>.</p>
    <p>To increase this (up to a maximum of 16 TB), simply set
        the <code>tmp</code> configuration setting to the number of GB of temp space you need. To prevent Boxfuse from
        provisioning any temp space set <code>tmp</code> to <code>0</code>.</p>

    <p class="next-steps">
        <a class="btn btn-primary" href="/docs/commandline">Command-line <i class="fa fa-arrow-right"></i></a>
    </p>

    <h2 id="sysctl">Linux Kernel Tuning (experts only)</h2>

    <p>If you need to tune the Linux kernel running in your instance, simply place a <code>sysctl.conf</code> file at the root inside your tgz file.
        This effectively means it should be in the root directory of your application:</p>
    <pre class="filetree"><i class="fa fa-folder-open"></i> my-nodejs-app
  <i class="fa fa-file-text"></i> package.json
  <span><i class="fa fa-file-text"></i> sysctl.conf</span></pre>

    <p>Boxfuse will then <strong>automatically configure the Linux kernel to use these settings</strong>.</p>
</div>