---
layout: blog
subtitle: "Deploy a Dropwizard Unikernel to AWS"
permalink: /blog/dropwizard-aws.html
---
<div>

    <div class="blog-post-image center">
        <img src="/assets/posts/dropwizard-aws-sm.png" alt="Dropwizard to AWS">
    </div>

    <p>Here at Boxfuse <a href="/blog/welcome.html">we strongly believe in keeping things simple</a>. We love
        <strong>lightweight solutions</strong> that <strong>do away with cargo cult</strong> and <strong>just work.</strong></p>

    <p>It turns out that when creating REST microservices <strong><a href="http://www.dropwizard.io/">Dropwizard</a></strong> is a perfect match for this.</p>

    <p>In this post we are going to look at how to fuse a Dropwizard application into a <strong>secure unikernel image</strong>.
        We will then <strong>test it locally on VirtualBox</strong>
        and finally we'll <strong>deploy it unchanged to AWS</strong>. All this in 3 easy steps.</p>

    <div class="blog-post-image center">
        <img src="/assets/posts/dropwizard-aws.png" alt="Dropwizard to AWS">
    </div>

    <h2 class="blog-post-section">Prerequisites</h2>

    <p>Before we get started, you will need a couple of things.</p>

    <p>First of all you will need an <strong>AWS Account</strong>.
        Go ahead and <a href="http://aws.amazon.com/">register for a free AWS account</a> now if you haven't got one already.
        Their free tier is great and will give you a free t2.micro (1 vCPU, 1 GB RAM) instance, a few GBs of S3 storage and much more for a whole year.
    </p>

    <p>You will also need a <strong>Boxfuse Account</strong>. If you haven't got one already, create a free Boxfuse
        account now by <a href="https://console.boxfuse.com">logging in the Boxfuse Console using your GitHub account</a>.
        Once logged in, <a href="https://console.boxfuse.com/#/awsAccount">connect your AWS account with your Boxfuse account</a>.
    </p>

    <p>Finally, ensure you have the Boxfuse Client, Java, Maven and VirtualBox installed on your machine.</p>

    <p>This tutorial works with Windows, Mac OSX and Linux and should take about 10 minutes to complete.</p>

    <h2 class="blog-post-section">Step 1: Fuse the Dropwizard app into a secure unikernel image</h2>

    <p>Start by creating a new application called <code>dropwizard</code> in the
        <a href="https://console.boxfuse.com">Boxfuse Console</a>. Select <em>Single Instance with Zero Downtime updates</em> (elastic IP) in the AWS eu-central-1 region:</p>

    <div class="blog-post-image">
        <img src="/assets/posts/new-app.png" alt="New application">
    </div>

    <p>Now <strong><a href="https://github.com/boxfuse/blog-dropwizard-aws/archive/1.0.zip">download the sample app</a></strong> and extract it in a new directory on your machine. Open a terminal
        and build it using Maven:</p>

    <pre class="console">&gt; mvn package</pre>

    <p>With that done you can now turn into it a secure unikernel using the Boxfuse Client:</p>

    <pre class="console">&gt; boxfuse fuse target/dropwizard-1.0.jar

Fusing Image for dropwizard-1.0.jar ...
Image fused in 00:07.073s (54017 K) -> axelfontaine/dropwizard:1.0</pre>

    <p>In just over 7 seconds, Boxfuse <strong>analysed the application</strong>, determined it was a Dropwizard application running on the JVM
        and automatically <strong>created the smallest possible image</strong> to run it. It also automatically set
        the ports and the healthcheck <strong>configuration
        to match that of Dropwizard</strong>.</p>

    <p>Let's check our available images:</p>

    <pre class="console" style="font-size: 10px">&gt; boxfuse ls

Images available locally:
+-----------------------------+--------------------+-------+---------+------------+--------------------------------+---------+---------------------+
| Image                       |      Payload       | Debug |  Java   | AppServer  |             Ports              |  Size   |    Generated at     |
+-----------------------------+--------------------+-------+---------+------------+--------------------------------+---------+---------------------+
| axelfontaine/dropwizard:1.0 | dropwizard-1.0.jar | false | 8.45.14 | Dropwizard | admin-http -> 8081, http -> 80 | 54017 K | 2015-04-25 23:32:54 |
+-----------------------------+--------------------+-------+---------+------------+--------------------------------+---------+---------------------+
Total: 1</pre>
    <p>Congratulations! You now a have a brand new 54 MB secure unikernel image!</p>

    <h2 class="blog-post-section">Step 2: Test it locally on VirtualBox</h2>

    <p>Now let's launch it on VirtualBox:</p>
    <pre class="console">&gt; boxfuse run dropwizard:1.0

Launching Instance of axelfontaine/dropwizard:1.0 on VirtualBox ...
Forwarding admin-http port localhost:50001 -> vb-033da2a4:8081
Forwarding http port localhost:8888 -> vb-033da2a4:80
Instance launched in 00:04.176s -> vb-033da2a4
Waiting for Payload to start on Instance vb-033da2a4 ...
Payload started in 00:08.525s -> http://127.0.0.1:8888</pre>

    <p>Now let's open a browser to the <code>/hello-world</code> resource and check everything is up:</p>

    <div class="blog-post-image">
        <img src="/assets/img/virtualbox.png" alt="VirtualBox" style="margin-right: 20px">
        <img src="/assets/posts/screenshot.png" alt="Screenshot">
    </div>

    <p>And indeed it shows up in our list of instances as well:</p>

    <pre class="console">&gt; boxfuse ps

Running Instances on VirtualBox :
+-------------+-----------------------------+---------------------+-----------------------+---------------------+
|  Instance   |            Image            |        Type         |          URL          |     Launched at     |
+-------------+-----------------------------+---------------------+-----------------------+---------------------+
| vb-033da2a4 | axelfontaine/dropwizard:1.0 | 4 CPU / 1024 MB RAM | http://127.0.0.1:8888 | 2015-04-25 23:42:20 |
+-------------+-----------------------------+---------------------+-----------------------+---------------------+
Total: 1</pre>

    <h2 class="blog-post-section">Step 3: Deploy it unchanged to AWS</h2>

    <p>Finally deploy the image unchanged to AWS:</p>

    <pre class="console" style="font-size: 10px">&gt; boxfuse run dropwizard:1.0 -env=prod

Pushing axelfontaine/dropwizard:1.0 ...
Verifying axelfontaine/dropwizard:1.0 ...
Creating Elastic IP ...
Mapping dropwizard-axelfontaine.boxfuse.io to 52.28.23.63 ...
Waiting for AWS to create an AMI for axelfontaine/dropwizard:1.0 in eu-central-1 (this may take up to 50 seconds) ...
AMI created in 00:31.067s -> ami-da744bc7
Creating security group boxfuse-sg_axelfontaine/dropwizard:1.0 ...
Launching t2.micro instance of axelfontaine/dropwizard:1.0 (ami-da744bc7) in eu-central-1 ...
Instance launched in 00:28.320s -> i-53be0c92
Waiting for Payload to start on Instance i-53be0c92 at http://52.28.14.76:8081/healthcheck ...
Remapping Elastic IP 52.28.23.63 to i-53be0c92 ...
Waiting 15s for AWS to complete Elastic IP Zero Downtime transition ...
Deployment completed successfully. axelfontaine/dropwizard:1.0 is up and running at http://dropwizard-axelfontaine.boxfuse.io:8081</pre>

    <p>Boxfuse automatically created a <strong>new Elastic IP address</strong> and a <strong>new domain</strong>.
        It pushed the image to the secure Boxfuse vault, registered an AMI and launched an instance.
    Then finally it mapped the Elastic IP onto the instance.</p>

    <p>Let's check if the instance came up:</p>

    <div class="blog-post-image">
        <img src="/assets/img/aws.png" alt="AWS" style="margin-right: 20px; width: 200px">
        <img src="/assets/posts/screenshot-aws.png" alt="Screenshot AWS" style="width: 600px">
    </div>

    <p>And it did!</p>

    <h2 class="blog-post-section">Done !</h2>

    <p>Congratulations! <strong>In just a few minutes and 3 easy steps you created a brand new unikernel image of the example Dropwizard application.</strong>
    This image is minimal, secure and portable. You ran it unchanged on both VirtualBox and AWS.</p>

    <p>Now go ahead, dive deeper and read the <a href="/docs">documentation</a>.</p>

    <p>Stay tuned for more by subscribing to this blog by email on the right of this page.</p>
</div>
